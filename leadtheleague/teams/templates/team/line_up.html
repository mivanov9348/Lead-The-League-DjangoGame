{% extends 'base.html' %}

{% block title %}Select Your Line-Up{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/lineup.css' %}">
{% endblock %}

{% block content %}
<!-- Parent container for flexbox layout -->
<div class="parent-container">
    <!-- Line-Up Section (40%) -->
    <div class="lineup-section">
        <div class="lineup-positions">
            <!-- Display Starting Players -->
            {% for pos in context.positions.GK %}
                <div class="lineup-slot {% if pos.is_started %}filled{% endif %}" id="slot-{{ pos }}">
                    {% if pos.is_started %}
                        {{ pos.player.first_name }} {{ pos.player.last_name }}
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="remove">-</button>
                        </form>
                    {% else %}
                        Goalkeeper ({{ pos }})
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="add">+</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- Display Defenders -->
            {% for pos in context.positions.DF %}
                <div class="lineup-slot {% if pos.is_started %}filled{% endif %}" id="slot-{{ pos }}">
                    {% if pos.is_started %}
                        {{ pos.player.first_name }} {{ pos.player.last_name }}
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="remove">-</button>
                        </form>
                    {% else %}
                        Defender ({{ pos }})
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="add">+</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- Display Midfielders -->
            {% for pos in context.positions.MF %}
                <div class="lineup-slot {% if pos.is_started %}filled{% endif %}" id="slot-{{ pos }}">
                    {% if pos.is_started %}
                        {{ pos.player.first_name }} {{ pos.player.last_name }}
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="remove">-</button>
                        </form>
                    {% else %}
                        Midfielder ({{ pos }})
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="add">+</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- Display Attackers -->
            {% for pos in context.positions.ATT %}
                <div class="lineup-slot {% if pos.is_started %}filled{% endif %}" id="slot-{{ pos }}">
                    {% if pos.is_started %}
                        {{ pos.player.first_name }} {{ pos.player.last_name }}
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="remove">-</button>
                        </form>
                    {% else %}
                        Attacker ({{ pos }})
                        <form action="{% url 'teams:modify_lineup' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="slot_id" value="{{ pos.id }}">
                            <button type="submit" name="action" value="add">+</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Players Section (60%) -->
    <div class="players-section">
        <table class="players-table">
            <thead>
                <tr>
                    <th>N</th>
                    <th>Name</th>
                    <th>Pos</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="players-list">
                <!-- Display Reserve Players -->
                {% for player in context.reservePlayers %}
                    <tr class="player-item" id="player-{{ player.id }}">
                        <td>{{ forloop.counter }}</td>
                        <td>{{ player.player_data.player.first_name }} {{ player.player_data.player.last_name }}</td>
                        <td>{{ player.player_data.player.positionabbr }}</td>
                        <td>
                            {% if not player.is_started %}
                            <form action="{% url 'teams:modify_lineup' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="player_id" value="{{ player.id }}">
                                <button type="submit" name="action" value="add">+</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
